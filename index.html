<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Birthday Celebration - Happy Birthday!</title>
    <meta name="description" content="A stunning 3D birthday celebration experience with balloons, confetti, and a beautiful cake. Celebrate someone special with this interactive animation.">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="3D Birthday Celebration">
    <meta property="og:description" content="A stunning 3D birthday celebration experience with balloons, confetti, and a beautiful cake.">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="3D Birthday Celebration">
    <meta property="twitter:description" content="A stunning 3D birthday celebration experience with balloons, confetti, and a beautiful cake.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r160/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #0a001f 0%, #1a0033 50%, #2a0066 100%);
        }
        
        #scene-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        canvas {
            display: block;
        }
        
        .overlay-text {
            pointer-events: none;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            background: linear-gradient(135deg, #ffd700 0%, #ff69b4 50%, #00ffff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s infinite;
        }
        
        .text-active {
            opacity: 1 !important;
        }
        
        @keyframes shimmer {
            0%, 100% {
                text-shadow: 0 0 20px rgba(255, 0, 255, 0.5), 0 0 40px rgba(0, 255, 255, 0.5);
            }
            50% {
                text-shadow: 0 0 40px rgba(255, 0, 255, 0.8), 0 0 80px rgba(0, 255, 255, 0.8);
            }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            box-shadow: 0 20px 60px rgba(255, 105, 180, 0.3);
            animation: float 3s ease-in-out infinite;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #9333ea 0%, #ec4899 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(147, 51, 234, 0.5);
        }
        
        .btn-replay {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .btn-replay:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }
        
        input:focus {
            outline: none;
            border-color: #9333ea;
            box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.3);
        }
    </style>
</head>
<body>
    <div id="scene-container">
        <!-- Birthday Text Overlay -->
        <div id="birthday-text" class="overlay-text fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center text-4xl md:text-7xl lg:text-8xl font-black tracking-wider z-40 px-4">
            Happy Birthday Someone Special!
        </div>

        <!-- Replay Button -->
        <button id="replay-button" class="btn-replay fixed bottom-8 right-8 px-6 py-3 rounded-full font-bold text-white opacity-0 pointer-events-none transition-all duration-500 z-50" style="display: none;">
            ðŸŽ‰ Replay
        </button>

        <!-- Name Input Modal -->
        <div id="prompt-modal" class="modal-backdrop fixed top-0 left-0 w-full h-full flex items-center justify-center z-50">
            <div class="modal-content p-8 rounded-2xl max-w-md w-full mx-4 text-center">
                <h2 class="text-4xl font-black mb-4 bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">
                    ðŸŽ‰ Birthday Time! ðŸŽ‰
                </h2>
                <p class="text-gray-700 mb-6 text-lg font-medium">
                    Who are we celebrating today?
                </p>
                <input 
                    type="text" 
                    id="name-input" 
                    placeholder="Enter name here..."
                    class="w-full p-4 mb-6 border-2 border-purple-300 rounded-xl text-xl font-semibold text-center transition-all duration-300"
                    maxlength="30"
                    autocomplete="off"
                >
                <button 
                    id="start-button"
                    class="btn-primary w-full text-white font-extrabold py-4 rounded-xl text-lg"
                >
                    Start Celebration âœ¨
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global Three.js variables
        let scene, camera, renderer, confetti = [], balloons = [];
        let animationId = null;
        let isSceneActive = false;

        // Configuration
        const config = {
            roomSize: 20,
            numBalloons: 15,
            numConfetti: 150,
            numGifts: 6
        };

        // --- SCENE INITIALIZATION ---
        function initScene(name) {
            // Clean up existing scene if any
            cleanupScene();
            
            const container = document.getElementById('scene-container');
            const width = window.innerWidth;
            const height = window.innerHeight;

            isSceneActive = true;

            // 1. Scene
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x0a001f, 10, 40);

            // 2. Camera
            camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 100);
            camera.position.set(20, 10, 20);
            camera.lookAt(0, 5, 0);

            // 3. Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(width, height);
            renderer.setClearColor(0x0a001f);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);

            // 4. Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const spotLight = new THREE.SpotLight(0xffffff, 40, 50, Math.PI * 0.2, 0.5, 1);
            spotLight.position.set(0, 15, 0);
            spotLight.castShadow = true;
            spotLight.shadow.mapSize.width = 2048;
            spotLight.shadow.mapSize.height = 2048;
            scene.add(spotLight);

            const pinkLight = new THREE.PointLight(0xff1493, 15, 30);
            pinkLight.position.set(-10, 10, -10);
            scene.add(pinkLight);

            const cyanLight = new THREE.PointLight(0x00ffff, 15, 30);
            cyanLight.position.set(10, 10, 10);
            scene.add(cyanLight);

            // 5. Build Scene
            createRoom();
            createCake();
            createBalloons();
            createConfetti();
            createGifts();

            // 6. Start Animation
            animate();
            setupCameraAnimation(name);

            // 7. Window Resize
            window.addEventListener('resize', onWindowResize);
        }

        function onWindowResize() {
            if (!camera || !renderer) return;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function cleanupScene() {
            isSceneActive = false;
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            if (renderer && renderer.domElement && renderer.domElement.parentNode) {
                renderer.domElement.parentNode.removeChild(renderer.domElement);
            }
            
            if (renderer) {
                renderer.dispose();
            }
            
            balloons = [];
            confetti = [];
            scene = null;
            camera = null;
            renderer = null;
        }

        // --- OBJECT CREATION ---
        function createRoom() {
            const roomSize = config.roomSize;
            
            // Floor
            const floorGeometry = new THREE.PlaneGeometry(roomSize * 2, roomSize * 2);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x1a0033,
                roughness: 0.8,
                metalness: 0.2,
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Walls
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0x2a0066,
                side: THREE.BackSide,
                roughness: 0.9,
            });
            const roomGeometry = new THREE.BoxGeometry(roomSize * 2, roomSize * 2, roomSize * 2);
            const room = new THREE.Mesh(roomGeometry, wallMaterial);
            room.position.y = roomSize;
            scene.add(room);
        }

        function createCake() {
            const cakeGroup = new THREE.Group();
            cakeGroup.position.set(0, 1.5, -config.roomSize / 2 + 2);

            // Base layer
            const baseGeo = new THREE.CylinderGeometry(3, 3, 2, 32);
            const baseMat = new THREE.MeshStandardMaterial({ color: 0xffd700, roughness: 0.5 });
            const base = new THREE.Mesh(baseGeo, baseMat);
            base.position.y = 1;
            base.castShadow = true;
            cakeGroup.add(base);

            // Middle layer
            const midGeo = new THREE.CylinderGeometry(2.5, 2.5, 1.5, 32);
            const midMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.3 });
            const mid = new THREE.Mesh(midGeo, midMat);
            mid.position.y = 2.75;
            mid.castShadow = true;
            cakeGroup.add(mid);

            // Top layer
            const topGeo = new THREE.CylinderGeometry(2, 2, 1, 32);
            const topMat = new THREE.MeshStandardMaterial({ color: 0xff69b4, roughness: 0.3 });
            const top = new THREE.Mesh(topGeo, topMat);
            top.position.y = 3.75;
            top.castShadow = true;
            cakeGroup.add(top);

            // Candles with flames
            const candlePositions = [
                { x: 1.2, z: 0 },
                { x: -1.2, z: 0 },
                { x: 0, z: 1.2 },
                { x: 0, z: -1.2 },
            ];

            candlePositions.forEach(pos => {
                const candleLight = new THREE.PointLight(0xffaa00, 8, 8);
                candleLight.position.set(pos.x, 4.5, pos.z);
                cakeGroup.add(candleLight);

                const flameGeo = new THREE.SphereGeometry(0.15, 8, 8);
                const flameMat = new THREE.MeshBasicMaterial({ color: 0xffaa00 });
                const flame = new THREE.Mesh(flameGeo, flameMat);
                flame.position.set(pos.x, 4.5, pos.z);
                cakeGroup.add(flame);
            });

            scene.add(cakeGroup);
        }

        function createBalloons() {
            const balloonColors = [0xff69b4, 0x00ced1, 0xffa500, 0x9400d3, 0xadff2f];

            for (let i = 0; i < config.numBalloons; i++) {
                const balloonGeo = new THREE.SphereGeometry(1, 32, 32);
                const balloonMat = new THREE.MeshStandardMaterial({
                    color: balloonColors[i % balloonColors.length],
                    transparent: true,
                    opacity: 0.9,
                    roughness: 0.3,
                    metalness: 0.1,
                });
                const balloon = new THREE.Mesh(balloonGeo, balloonMat);
                balloon.scale.set(1, 1.5, 1);
                balloon.position.set(
                    (Math.random() - 0.5) * config.roomSize,
                    Math.random() * config.roomSize + 5,
                    (Math.random() - 0.5) * config.roomSize
                );
                balloon.userData.velocity = new THREE.Vector3(
                    (Math.random() - 0.5) * 0.02,
                    Math.random() * 0.03 + 0.02,
                    (Math.random() - 0.5) * 0.02
                );
                balloon.userData.phase = Math.random() * Math.PI * 2;
                balloon.castShadow = true;
                scene.add(balloon);
                balloons.push(balloon);

                // String
                const stringGeo = new THREE.CylinderGeometry(0.03, 0.03, 5, 8);
                const stringMat = new THREE.MeshBasicMaterial({ color: 0x333333 });
                const string = new THREE.Mesh(stringGeo, stringMat);
                string.position.y = -2.5;
                balloon.add(string);
            }
        }

        function createConfetti() {
            const confettiColors = [0xffd700, 0x00ffff, 0xff00ff, 0xffa500, 0x00ff00];

            for (let i = 0; i < config.numConfetti; i++) {
                const confettiGeo = new THREE.PlaneGeometry(0.2, 0.3);
                const confettiMat = new THREE.MeshBasicMaterial({
                    color: confettiColors[i % confettiColors.length],
                    side: THREE.DoubleSide,
                });
                const piece = new THREE.Mesh(confettiGeo, confettiMat);
                piece.position.set(
                    (Math.random() - 0.5) * config.roomSize,
                    Math.random() * config.roomSize + 10,
                    (Math.random() - 0.5) * config.roomSize
                );
                piece.rotation.set(
                    Math.random() * Math.PI,
                    Math.random() * Math.PI,
                    Math.random() * Math.PI
                );
                piece.userData.rotationSpeed = {
                    x: (Math.random() - 0.5) * 0.1,
                    y: (Math.random() - 0.5) * 0.1,
                    z: (Math.random() - 0.5) * 0.1,
                };
                scene.add(piece);
                confetti.push(piece);
            }
        }

        function createGifts() {
            const giftColors = [0xffa500, 0x00ff00, 0xff00ff, 0x00aaff, 0xff4444];
            
            for (let i = 0; i < config.numGifts; i++) {
                const sizeX = Math.random() * 1.5 + 1.5;
                const sizeY = Math.random() * 1 + 1;
                const sizeZ = Math.random() * 1.5 + 1.5;

                const giftGroup = new THREE.Group();

                const giftGeo = new THREE.BoxGeometry(sizeX, sizeY, sizeZ);
                const giftMat = new THREE.MeshStandardMaterial({
                    color: giftColors[i % giftColors.length],
                    roughness: 0.5,
                    metalness: 0.2,
                });
                const gift = new THREE.Mesh(giftGeo, giftMat);
                gift.castShadow = true;
                giftGroup.add(gift);

                // Ribbons
                const ribbonMat = new THREE.MeshStandardMaterial({ color: 0xffffff, metalness: 0.5 });
                const ribbonX = new THREE.Mesh(
                    new THREE.BoxGeometry(sizeX * 1.05, sizeY * 1.05, 0.2),
                    ribbonMat
                );
                giftGroup.add(ribbonX);

                const ribbonZ = new THREE.Mesh(
                    new THREE.BoxGeometry(0.2, sizeY * 1.05, sizeZ * 1.05),
                    ribbonMat
                );
                giftGroup.add(ribbonZ);

                giftGroup.position.set(
                    (Math.random() - 0.5) * (config.roomSize - 6),
                    sizeY / 2,
                    Math.random() * (config.roomSize / 2) - 2
                );
                giftGroup.rotation.y = Math.random() * Math.PI / 4;
                scene.add(giftGroup);
            }
        }

        // --- ANIMATION ---
        function animate() {
            if (!isSceneActive || !scene || !camera || !renderer) return;
            
            const time = Date.now() * 0.001;

            // Balloon animation
            balloons.forEach((b) => {
                b.userData.phase += 0.02;
                b.position.x += Math.sin(time * 2 + b.userData.phase) * 0.015;
                b.position.z += Math.cos(time * 1.5 + b.userData.phase) * 0.015;
                b.position.y += b.userData.velocity.y;

                if (b.position.y > 25) {
                    b.position.y = 2;
                    b.position.x = (Math.random() - 0.5) * 15;
                    b.position.z = (Math.random() - 0.5) * 15;
                }

                b.rotation.y += 0.01;
            });

            // Confetti animation
            confetti.forEach(c => {
                c.rotation.x += c.userData.rotationSpeed.x;
                c.rotation.y += c.userData.rotationSpeed.y;
                c.rotation.z += c.userData.rotationSpeed.z;
                c.position.y -= 0.03;

                if (c.position.y < -2) {
                    c.position.y = 25;
                    c.position.x = (Math.random() - 0.5) * 20;
                    c.position.z = (Math.random() - 0.5) * 20;
                }
            });

            renderer.render(scene, camera);
            animationId = requestAnimationFrame(animate);
        }

        function setupCameraAnimation(name) {
            const cameraPath = [
                { pos: new THREE.Vector3(20, 10, 20), target: new THREE.Vector3(0, 5, 0), duration: 4 },
                { pos: new THREE.Vector3(-10, 8, 8), target: new THREE.Vector3(0, 5, 0), duration: 4 },
                { pos: new THREE.Vector3(8, 6, -5), target: new THREE.Vector3(0, 3, -config.roomSize / 2 + 2), duration: 4 },
                { pos: new THREE.Vector3(0, 4, -config.roomSize / 2 + 5), target: new THREE.Vector3(0, 3, -config.roomSize / 2 + 2), duration: 3 },
            ];

            let currentPathIndex = 0;
            let pathProgress = 0;
            let lastTime = Date.now();

            function updateCamera() {
                if (!isSceneActive || currentPathIndex >= cameraPath.length) {
                    if (currentPathIndex >= cameraPath.length) {
                        showBirthdayText(name);
                    }
                    return;
                }

                const currentTime = Date.now();
                const deltaTime = (currentTime - lastTime) / 1000;
                lastTime = currentTime;

                const path = cameraPath[currentPathIndex];
                pathProgress += deltaTime / path.duration;

                if (pathProgress >= 1) {
                    pathProgress = 0;
                    currentPathIndex++;
                } else {
                    const t = pathProgress;
                    const smoothT = t * t * (3 - 2 * t); // Smoothstep

                    if (currentPathIndex > 0) {
                        const prevPath = cameraPath[currentPathIndex - 1];
                        camera.position.lerpVectors(prevPath.pos, path.pos, smoothT);
                        const targetPos = new THREE.Vector3().lerpVectors(prevPath.target, path.target, smoothT);
                        camera.lookAt(targetPos);
                    } else {
                        camera.position.copy(path.pos);
                        camera.lookAt(path.target);
                    }
                }

                requestAnimationFrame(updateCamera);
            }

            updateCamera();
        }

        function showBirthdayText(name) {
            const textElement = document.getElementById('birthday-text');
            textElement.textContent = `Happy Birthday ${name}!`;
            textElement.classList.add('text-active');
            
            // Show replay button
            const replayButton = document.getElementById('replay-button');
            replayButton.style.display = 'block';
            setTimeout(() => {
                replayButton.style.opacity = '1';
                replayButton.style.pointerEvents = 'auto';
            }, 1000);
        }

        // --- EVENT HANDLERS ---
        window.onload = function() {
            const inputElement = document.getElementById('name-input');
            const startButton = document.getElementById('start-button');
            const modal = document.getElementById('prompt-modal');
            const replayButton = document.getElementById('replay-button');

            inputElement.focus();

            function startAnimation() {
                let name = inputElement.value.trim();
                if (name === "") {
                    name = "Someone Special";
                }
                
                modal.style.transition = 'opacity 0.5s ease-out';
                modal.style.opacity = '0';
                
                setTimeout(() => {
                    modal.style.display = 'none';
                    initScene(name);
                }, 500);
            }

            function replayAnimation() {
                const textElement = document.getElementById('birthday-text');
                textElement.classList.remove('text-active');
                
                replayButton.style.opacity = '0';
                replayButton.style.pointerEvents = 'none';
                
                setTimeout(() => {
                    replayButton.style.display = 'none';
                    modal.style.display = 'flex';
                    modal.style.opacity = '0';
                    inputElement.value = '';
                    inputElement.focus();
                    
                    setTimeout(() => {
                        modal.style.opacity = '1';
                    }, 50);
                }, 500);
            }

            startButton.addEventListener('click', startAnimation);
            replayButton.addEventListener('click', replayAnimation);
            
            inputElement.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    startAnimation();
                }
            });
        };
    </script>
</body>
</html>